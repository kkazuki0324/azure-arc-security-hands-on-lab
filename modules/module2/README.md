# モジュール 2: Azure Arc でのサーバーオンボーディング

このモジュールでは、オンプレミス環境のサーバーを Azure Arc を使用してオンボーディングします。

## 目標

- Azure Arc for Servers の概要を理解する
- Azure Arc 対応サーバーのリソースグループを作成する
- Azure Arc エージェントをインストールする
- オンボーディングを確認する

## タスク 1: Azure Arc 対応サーバーのリソースグループを作成する

1. [Azure ポータル](https://portal.azure.com)にサインインします。
2. 検索バーに「**リソースグループ**」と入力し、表示されるサービスをクリックします。
3. 「**作成**」をクリックします。
4. 以下の設定を入力します：
   - **サブスクリプション**: ご使用のサブスクリプション
   - **リソースグループ**: ArcServers-RG
   - **地域**: お近くのリージョン
5. 「**確認および作成**」をクリックし、検証が完了したら「**作成**」をクリックします。

## タスク 2: オンプレミスサーバーの準備

1. モジュール 1 でセットアップした「OnPremServer」仮想マシンに RDP 接続します。
2. スタートメニューを右クリックし、「**Windows PowerShell (管理者)**」を選択します。
3. 次のコマンドを実行して、サーバーの名前を確認します：

```powershell
hostname
```

4. PowerShell ウィンドウを開いたままにしておきます。

## タスク 3: Azure Arc 接続スクリプトを生成する

1. Azure ポータルで、検索バーに「**Azure Arc**」と入力し、表示されるサービスをクリックします。
2. 左側のメニューから「**マシン - Azure Arc**」をクリックします。
3. 「**追加**」ボタンをクリックします。
4. 「**サーバーの追加**」をクリックします。
5. 「**スクリプトを生成する**」タブを選択します。
6. 次の設定を入力します：

   - **サブスクリプション**: ご使用のサブスクリプション
   - **リソースグループ**: ArcServers-RG
   - **地域**: お近くのリージョン
   - **オペレーティングシステム**: Windows
   - **接続方法**: スクリプトを生成して実行する

7. 「**次へ: タグ**」をクリックします。
8. 任意のタグを追加します（例: Environment=Lab）。
9. 「**次へ: スクリプトのダウンロード**」をクリックします。
10. 「**スクリプトのダウンロード**」をクリックし、スクリプトをダウンロードします。

## タスク 4: Azure Arc エージェントのインストール

1. ダウンロードしたスクリプト（OnboardingScript.ps1）を「OnPremServer」仮想マシンにコピーします。方法の一つは：

   - OnPremServer のデスクトップに一時的なフォルダを作成します
   - Microsoft Edge または Internet Explorer を開き、OneDrive などのクラウドストレージにスクリプトをアップロードし、OnPremServer からダウンロードします

2. OnPremServer の管理者 PowerShell で、スクリプトがある場所に移動します：

```powershell
cd C:\path\to\script\folder
```

3. スクリプトを実行します：

```powershell
.\OnboardingScript.ps1
```

4. スクリプトが実行されると、Azure 認証が要求されます。表示される URL にアクセスし、コードを入力してログインします。
5. インストールが完了するまで待ちます（約 5 分程度）。

## タスク 5: オンボーディングの確認

1. Azure ポータルに戻り、「**Azure Arc**」→「**マシン - Azure Arc**」に移動します。
2. リストに OnPremServer が表示され、ステータスが「接続済み」になっていることを確認します。
3. OnPremServer をクリックして、詳細ページを確認します。

![Azure Arc接続済みサーバー](../../images/module2/connected-server.png)

## タスク 6: Azure Arc 機能の確認

1. OnPremServer の詳細ページで、左側のメニューから「**拡張機能**」をクリックします。
2. 「**追加**」をクリックし、利用可能な拡張機能を確認します。
3. 左側のメニューから「**ポリシー**」をクリックし、Azure Policy 機能を確認します。
4. 左側のメニューから「**更新**」をクリックし、更新管理機能を確認します。

## 次のステップ

これで、オンプレミスサーバーが Azure Arc に正常にオンボーディングされました。次のモジュールでは、Microsoft Defender for Servers を有効化して構成します。

[モジュール 3: Microsoft Defender for Servers の有効化と構成](../module3/README.md)に進みます。
